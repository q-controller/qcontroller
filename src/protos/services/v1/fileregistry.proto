syntax = "proto3";

package services.v1;

option go_package = "github.com/q-controller/qcontroller/src/generated/services/v1;v1";

message UploadImageRequest {
    string image_id = 1;
    bytes chunk = 2;
    bool replace = 3; // optional: sent in the first message only
}

message UploadImageResponse {
    string image_id = 1;
}

message DownloadImageRequest {
    string image_id = 1;
}

message DownloadImageResponse {
    bytes chunk = 1;
}

message RemoveImageRequest {
    string image_id = 1;
}

message RemoveImageResponse {
    bool removed = 1;
}

message ListImagesRequest {
}

message VMImage {
	string image_id = 1;
	string hash = 2;
	int64 size = 3;
	string uploaded_at = 4;
}

message ListImagesResponse {
    repeated VMImage images = 1;
}

service FileRegistryService {
    rpc UploadImage(stream UploadImageRequest) returns (UploadImageResponse) {}
    rpc DownloadImage(DownloadImageRequest) returns (stream DownloadImageResponse) {}
    rpc RemoveImage(RemoveImageRequest) returns (RemoveImageResponse) {}
    rpc ListImages(ListImagesRequest) returns (ListImagesResponse) {}
}
